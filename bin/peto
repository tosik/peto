#!/bin/ruby

$LOAD_PATH.unshift(File.join(File.dirname(__FILE__), '..', 'lib'))
$LOAD_PATH.unshift(File.dirname(__FILE__))
require "peto"

require "optparse"
options = {}
OptionParser.new do |opt|
  opt.on("-o output directory") {|value| options[:output] = value }
  opt.parse!(ARGV)
end
input = ARGV.pop

if input.nil?
  puts "usage:\n  % peto contract.yml"
  exit
end

options[:output] = File.join(File.dirname(input),
                             File.basename(input, ".yml") + ".rb") if options[:output].nil?

peto = Peto::Master.new
peto.load(input)
open(options[:output],"w") do |file|
  file.write(peto.generate)
end

